<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="brukerSide.js" defer></script>
    <link rel="stylesheet" href="brukerSide.css">
    <title>EasyLove</title>
</head>
<body id="hoved">
    <header id="header">
        <img src="../brukerRegistrering/Bilder/Logo.png" alt="" class="l" id="logo">
        <div id="profilBilde" class="b"></div>
    </header>
    <!-- <label for="profilBildeUpload">Last opp ett profilbilde:</label>
    <input type="file" id="profilBildeUpload" name="profilBildeUpload" accept="image/png, image/jpeg">
    <button id="submit">Lagre</button> -->

    <div class="kamera">
        <video id="video">Video er utilgjengelig</video>
        <button id="startKnapp"> Ta dagens bilde!</button>
    </div>
    <canvas id="canvas"> </canvas>    

    <div id="container">
        <h3>Her kan du endre informasjonen om deg</h3>
        <label for="brukernavn">Brukernavn</label> 
        <input type="text" class="inputFelt" id="brukernavn" >
        <label for="email">Email</label> 
        <input type="text" class="inputFelt" id="email" >
        <label for="fornavn">Fornavn</label> 
        <input type="text" class="inputFelt" id="fornavn" >
        <label for="etternavn">Etternavn</label> 
        <input type="text" class="inputFelt" id="etternavn" >
        <div id="kjonn">
        <input type="radio" class="Mann" name="kjonn" id="brukerKjonn" value="Mann">Herre<br>
        <input type="radio" class="Kvinne" name="kjonn" id="brukerKjonn" value="Kvinne">Kvinne<br>
        <input type="radio" class="Annet" name="kjonn" id="brukerKjonn" value="Annet">Annet<br>   
        </div>
    </div>

    <button id="tilPreferanser">Endre dine preferanser her</button>
    <button id="tilInteresser">Endre dine interesser her</button>
    
</body>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";
    import { collection, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";
        
     const firebaseConfig = {
        apiKey: "AIzaSyCoRH-HJRelRMyBqOr0NCE-Fx7sdUbjQsY",
        authDomain: "datingside-98657.firebaseapp.com",
        projectId: "datingside-98657",
        storageBucket: "datingside-98657.appspot.com",
        messagingSenderId: "323999360874",
        appId: "1:323999360874:web:fc7215729fdc361a98e713"
        };

        let brukerID = localStorage.getItem("brukerID");

        export const app = initializeApp(firebaseConfig);
        export const db = getFirestore(app);

        const docRef = doc(db, "test", brukerID);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
        console.log("Document data:", docSnap.data());
        let brukerData = docSnap.data();
        let splittetNavn = brukerData.navn.split(" ");
        console.log(brukerData);
        document.getElementById("brukernavn").value = brukerData.brukernavn;
        document.getElementById("email").value = brukerData.email
        document.getElementById("fornavn").value = splittetNavn[0]
        document.getElementById("etternavn").value = splittetNavn[1]
        document.querySelector('input[value = ' + brukerData.kjonn + "]").checked = true;
    } else {
    // docSnap.data() will be undefined in this case
        console.log("No such document!");
    }

        async function oppdaterBruker() {
            console.log(brukerID)
            let nyttBrukerNavn = document.getElementById("brukernavn").value
            let nyEmail = document.getElementById("email").value
            let nyttNavn = document.getElementById("fornavn").value + " " + document.getElementById("etternavn").value
            let nyttKjonn = document.querySelector('input[name ="kjonn"]:checked').value;

            try {
                const docRef = await updateDoc(doc(db, "test", brukerID), {
                    brukernavn: nyttBrukerNavn,
                    email: nyEmail,
                    navn: nyttNavn,
                    kjonn: nyttKjonn
                
                })
            }
            catch (e){
                console.error("Error adding document: ", e)
            }
        }

       

        
        

    document.getElementById("brukernavn").addEventListener('change', oppdaterBruker)
    document.getElementById("email").addEventListener('change', oppdaterBruker)
    document.getElementById("fornavn").addEventListener('change', oppdaterBruker)
    document.getElementById("etternavn").addEventListener('change', oppdaterBruker)



</script>
</html>