<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>preferanser</title>
    <!-- <script src="preferanser.js" defer></script> -->
    <link rel="stylesheet" href="preferanser.css">
</head>
<body id="hoved">
    <div id="flaggContainer">
        <img id="flagg_AU" class="flagg" src="flagg/AU_flagg.png" alt="Flagget til Australia" title="Australia">
        <img id="flagg_BR" class="flagg" src="flagg/BR_flagg.png" alt="Flagget til Brasil" title="Brasil">
        <img id="flagg_CA" class="flagg" src="flagg/CA_flagg.png" alt="Flagget til Canada" title="Canada">
        <img id="flagg_CH" class="flagg" src="flagg/CH_flagg.png" alt="Flagget til Sveits" title="Sveits">
        <img id="flagg_DE" class="flagg" src="flagg/DE_flagg.png" alt="Flagget til Tyskland" title="Tyskland">
        <img id="flagg_ES" class="flagg" src="flagg/ES_flagg.png" alt="Flagget til Spania" title="Spania">
        <img id="flagg_FI" class="flagg" src="flagg/FI_flagg.png" alt="Flagget til Finland" title="Finland">
        <img id="flagg_FR" class="flagg" src="flagg/FR_flagg.png" alt="Flagget til Frankrike" title="Frankrike">
        <img id="flagg_GB" class="flagg" src="flagg/GB_flagg.png" alt="Flagget til Storbritannia" title="Storbritannia">
        <img id="flagg_IE" class="flagg" src="flagg/IE_flagg.png" alt="Flagget til Irland" title="Irland">
        <img id="flagg_IN" class="flagg" src="flagg/IN_flagg.png" alt="Flagget til India" title="India">
        <img id="flagg_MX" class="flagg" src="flagg/MX_flagg.png" alt="Flagget til Meksiko" title="Meksiko">
        <img id="flagg_NL" class="flagg" src="flagg/NL_flagg.png" alt="Flagget til Nederland" title="Nederland">
        <img id="flagg_NO" class="flagg" src="flagg/NO_flagg.png" alt="Flagget til Norge" title="Norge">
        <img id="flagg_RS" class="flagg" src="flagg/RS_flagg.png" alt="Flagget til Russland" title="Russland">
        <img id="flagg_TR" class="flagg" src="flagg/TR_flagg.png" alt="Flagget til Tyrkia" title="Tyrkia">
        <img id="flagg_UA" class="flagg" src="flagg/UA_flagg.png" alt="Flagget til Ukraina" title="Ukraina">
        <img id="flagg_US" class="flagg" src="flagg/US_flagg.png" alt="Flagget til USA" title="USA">
    </div>
    <div id="knapper">
        <label for="check1"><input type="checkbox" name="kjonn" value="female" id="checkfemale">Kvinner</label>
        <label for="check2"><input type="checkbox" name="kjonn" value="male" id="checkmale">Menn</label>
    </div>
    <div id="knapper">
        <button id="gåTilbake">Gå tilbake</button><br>
        <button id="gåVidere">Gå videre</button>
    </div>
    <div class="OverLay" id="overlay">
        <img src="bilder/lastegif.gif" alt="" id="laste">
    </div>
   
</body>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";
    import { collection, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";
    
    const firebaseConfig = {
        apiKey: "",
        authDomain: "datingside-98657.firebaseapp.com",
        projectId: "datingside-98657",
        storageBucket: "datingside-98657.appspot.com",
        messagingSenderId: "323999360874",
        appId: "1:323999360874:web:fc7215729fdc361a98e713"
    };

    let brukerID = localStorage.getItem("brukerID");

    export const app = initializeApp(firebaseConfig);
    export const db = getFirestore(app);

    async function oppdaterPreferanser() {
        try {
            const docRef = await updateDoc(doc(db, "test", brukerID), {
                nasjonalitetPreferanse: valgteLand,
                kjonnPreferanse: valgteKjønn
            });
        } catch (e) {
            console.error("Error adding document: ", e);
        }
    }

    const docRef = doc(db, "test", brukerID);
    const docSnap = await getDoc(docRef);

    let valgteLand = [];
    let valgteKjønn = [];

    if (docSnap.exists()) {
        console.log("Document data:", docSnap.data());
        let brukerData = docSnap.data();
        console.log(brukerData);
        valgteLand = brukerData.nasjonalitetPreferanse;
        valgteKjønn = brukerData.kjonnPreferanse;
    } else {
    // docSnap.data() will be undefined in this case
        console.log("No such document!");
    }

    oppdaterPreferanser()

    document.getElementById("flagg_ES").addEventListener("click", (event) => {click('ES')});
    document.getElementById("flagg_AU").addEventListener("click", (event) => {click('AU')});
    document.getElementById("flagg_BR").addEventListener("click", (event) => {click('BR')});
    document.getElementById("flagg_CA").addEventListener("click", (event) => {click('CA')});
    document.getElementById("flagg_CH").addEventListener("click", (event) => {click('CH')});
    document.getElementById("flagg_DE").addEventListener("click", (event) => {click('DE')});
    document.getElementById("flagg_FI").addEventListener("click", (event) => {click('FI')});
    document.getElementById("flagg_FR").addEventListener("click", (event) => {click('FR')});
    document.getElementById("flagg_GB").addEventListener("click", (event) => {click('GB')});
    document.getElementById("flagg_IE").addEventListener("click", (event) => {click('IE')});
    document.getElementById("flagg_IN").addEventListener("click", (event) => {click('IN')});
    document.getElementById("flagg_MX").addEventListener("click", (event) => {click('MX')});
    document.getElementById("flagg_NL").addEventListener("click", (event) => {click('NL')});
    document.getElementById("flagg_NO").addEventListener("click", (event) => {click('NO')});
    document.getElementById("flagg_RS").addEventListener("click", (event) => {click('RS')});
    document.getElementById("flagg_TR").addEventListener("click", (event) => {click('TR')});
    document.getElementById("flagg_UA").addEventListener("click", (event) => {click('UA')});
    document.getElementById("flagg_US").addEventListener("click", (event) => {click('US')});

    document.getElementById("gåVidere").addEventListener("click", gåVidere);
    document.getElementById("gåTilbake").addEventListener("click", gåTilbake);





    for(let i = 0; i < valgteLand.length; i++) {
         document.getElementById("flagg_" + valgteLand[i]).classList.toggle('click');
    }

    for(let i = 0; i < valgteKjønn.length; i++) {
         document.getElementById("check" + valgteKjønn[i]).checked = true;
    }

    function click(country) {
        document.getElementById("flagg_" + country).classList.toggle('click');

        let posisjon = valgteLand.indexOf(country);
        if (posisjon >= 0) {
            valgteLand.splice(posisjon, 1);
        }
        else {
            valgteLand.push(country);
        }
        console.log(valgteLand);
    }

    function gåVidere() {
        document.getElementById("laste").style.display = "block";
        document.getElementById("overlay").style.display = "inline";
        
        localStorage.setItem("land", JSON.stringify(valgteLand));
        let checkboxes = document.querySelectorAll('input[name="kjonn"]');
        checkboxes.forEach((checkbox) => {
            if (checkbox.checked === true) {
                if (!valgteKjønn.includes(checkbox.value)) {
                    valgteKjønn.push(checkbox.value);
                }
            }
            else if (valgteKjønn.includes(checkbox.value)) {
                valgteKjønn.splice(checkbox.value, 1);
            }


        });
        //alert(valgteKjønn);
        oppdaterPreferanser()
        // localStorage.setItem("kjonnPreferanse", JSON.stringify(valgteKjønn));
        setTimeout(() => {
            document.location.href = "../brukerInteresser/intresser.html";
        }, "1000");
        
    }

    function gåTilbake() {
        document.location.href = "../brukerRegistrering/index.html"
    }
</script>
</html>